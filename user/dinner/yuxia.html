<!DOCTYPE HTML>
<html>
<head>
<title>Home</title>
<link href="../../css/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="../../css/bootstrap.css" rel='stylesheet' type='text/css' />
<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="../../js/jquery.min.js"></script>
<!-- Custom Theme files -->
<link href="../../css/style.css" rel='stylesheet' type='text/css' />
<!-- Custom Theme files -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
</script>
<!----webfonts---->
<link href='http://fonts.googleapis.com/css?family=Exo+2:100,200,300,400,500,600,700,800,900' rel='stylesheet' type='text/css'>
</head>
<body>
	<div class="header">
		<div class="container">
		  <div class="header_top">
			<ul class="phone">
				<li class="phone_left"><i class="mobile"> </i><span>1-200-346-2986</span></li>
				<!-- <li class="phone_right">Free Ground Shipping for Products over ￥100</li> -->
				<div class="clearfix"></div>
			</ul>
			<div class="clearfix"></div>
		</div>
		<div class="header_bottom">
		  <div class="header_nav">
      		<div class="logo">
				<a><img src="../../images/logo.png" alt=""/><br></a>
			 </div>
			 <nav class="navbar navbar-default menu" role="navigation"><h3 class="nav_right"><a href="index.html"><img src="../../images/logo.png" class="img-responsive" alt=""/></a></h3>
			  <div class="container-fluid">
			    <!-- Brand and toggle get grouped for better mobile display -->
			    <div class="navbar-header">
			      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
			        <span class="sr-only">Toggle navigation</span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
			    </div>
				<!-- Collect the nav links, forms, and other content for toggling -->
			    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			      <ul class="nav navbar-nav menu1">
			      	<li class="active"><a href="../user.html">菜单</a></li>
			        <li><a href="../order.html">订单</a></li>
			        <li><a href="../business.html">商家</a></li>
		          </ul>
		          <ul class="login">
		          	<a><li class="login_top"><i class="sign"> </i><span>登出</span></li></a>
		            <!-- <a href="register.html"><li class="login_bottom"><i class="register"> </i><span>Register</span></li></a> -->
		          </ul>
			      <div class="clearfix"></div>
			    </div><!-- /.navbar-collapse -->
			  </div><!-- /.container-fluid -->
			</nav>
            <div class="clearfix"></div>
           </div>
            <!-- <div class="search">
			  <input type="text" class="text" value="Enter Product Details" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Enter Product Details';}">
			  <input type="submit" value="Search">
			</div> -->
		 </div>  
		</div>
	</div>
    <div class="main">
		<div class="container">
		   <div class="row content" style="margin-top: 30px;">
		   	<div class="col-md-3 content_top">
		   	   <div class="category_box">
		   	  	<h3 class="cate_head">点菜</h3>
		   	     <ul class="category">
					<li><a href="./jiaozi.html">饺子类</a></li>
					<li><a href="./noodles.html">面类</a></li>
			   	  	<li><a href="./gaifan.html">盖饭类</a></li>
			   	  	<li><a href="./kaochuan.html">烤串类</a></li>
			   	  	<li><a href="./xiaochao.html">家常小炒类</a></li>
			   	  	<li><a href="./yuxia.html" class="activeNav">鱼虾类</a></li>
			   	  	<li><a href="./tang.html">汤类</a></li>
			   	  	<li><a href="./ganguo.html">干锅系列</a></li>
		   	     </ul>
		   	   </div>
		   	   <ul class="product_reviews">
		   	   	 <h3><i class="arrow"> </i><span>支付方式</span></h3>
		   	   	 <img src="../../images/pay1.jpeg" class="img-responsive" alt=""/>
		   	   </ul>
		   	</div>
		   	<div class="col-md-9">
		   	   <div class="tlinks">Collect from <a href="http://www.cssmoban.com/"  title="网站模板">网站模板</a></div>
		   	   <div class="row content_bottom">
			   	   
		    </div>
		   </div>
		</div>
	</div>
</body>
<script>
	$(function() {
		window.onload = handleList()
		$('.userName').innerHTML = sessionStorage.getItem('userName')
	})
	function clickOrder(obj) {
		console.log(obj)
		const box = obj.parentElement.parentElement.parentElement.parentElement.parentElement
		const name = box.getElementsByTagName('p')[0].innerHTML
		const num = box.getElementsByClassName('but1')[0].getElementsByClassName('num')[0].innerHTML
		if (Number(num) === 0) {
			alert('下单失败，数量不可为0！！！')
		} else {
			const sendData = {
				mealName: name,
				userName: sessionStorage.getItem('userName'),
				number: num
			}
			$.ajax({
				type : "POST",
				url : 'http://192.168.31.248:6736/order/add', 
				data : JSON.stringify(sendData),
				// dataType: 'json',
				success : function(obj){
					handleList()
					window.location.href = 'file:///C:/Users/Administrator/Desktop/dinner/user/dinner/yuxia.html'
				},
				headers: {
					"Content-Type":"application/json"
				}
			})
		}
	}
	function clickBuy(obj) {
		// console.log(obj.parentElement.parentElement.getElementsByClassName('fade')[0].modal)
		// obj.parentElement.parentElement.getElementsByClassName('modal')[0].modal('hide')
		// var numInput = obj.parentElement.getElementsByClassName('num')[0].innerHTML
		// var price = obj.parentElement.parentElement.getElementsByClassName('actual')[0].innerHTML
		// var countInput = document.getElementsByClassName('shop_right')[0].getElementsByTagName('span')[1]
		// var count = numInput * price
		// countInput.innerHTML = Number(countInput.innerHTML) + count + ''
		const num = obj.parentElement.getElementsByClassName('num')[0].innerHTML
		let modalNum = obj.parentElement.parentElement.getElementsByClassName('fade')[0].getElementsByClassName('num')[0] // 份数
		modalNum.innerHTML = num
	}
	function clickSub (obj) {
		var numInput = obj.parentElement.getElementsByClassName('num')[0]
		console.log(numInput.innerHTML)
		if (Number(numInput.innerHTML) > 0) {
			numInput.innerHTML = numInput.innerHTML - 1
		}
	}
	function clickAdd (obj) {
		var numInput = obj.parentElement.getElementsByClassName('num')[0]
		numInput.innerHTML++
	}
	$(document).ready(function(){
		if (!sessionStorage.getItem('userName')) {
			window.location.href = 'file:///C:/Users/Administrator/Desktop/dinner/index.html'
		}
	})
	$(".login").click(function() {
		window.location.href = 'file:///C:/Users/Administrator/Desktop/dinner/index.html'
		sessionStorage.removeItem('userName')
		sessionStorage.removeItem('userPsword')
		alert('退出登录成功')
	})
	
	function handleList() {
		$.get('http://192.168.31.248:6736/menu/get', function(obj) {
			document.getElementsByClassName('content_bottom')[0].innerHTML = ''
			obj['yuxia'].map((item, index) => {
				let popHtml = ''
				popHtml += '<div class="col-md-3" style="margin-bottom:20px"><div class="content_box"><div class="view view-fifth"><img src="../../images/p'+parseInt(Math.random()*20+0)+'.jpg" style="width:187px;height:127px" class="img-responsive" alt=""/><div class="content_box-grid">'
				popHtml += '<p class="m_1">'+item.mealName+'</p><div class="price">价格:￥<span class="actual">'+item.mealPrice+'</span></div>'
				popHtml += '<div class="but1" style="margin-top: 10px;"><span class="glyphicon glyphicon-minus" aria-hidden="true" style="font-size: 22px;cursor: pointer;" onclick="clickSub(this)"></span><span class="num">0</span><span class="glyphicon glyphicon-plus" style="font-size: 22px;cursor: pointer;" aria-hidden="true" onclick="clickAdd(this)"></span><a href="#" style="margin-left: 20px;" data-toggle="modal" data-target="#myModalBottom'+index+'" onclick="clickBuy(this)">立即购买</a></div>'
				popHtml += '<div class="modal fade" id="myModalBottom'+index+'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">提示：</span></h4><h4></h4></div><div class="modal-body"><div class="input-group"><span class="" id="basic-addon2">确认下单？</span><div style="margin-top:10px;font-size:14px"><span>菜品：</span><span>'+item.mealName+'</span></div><div style="margin-top:5px;font-size:14px"><span>价格：</span><span>￥'+item.mealPrice+'</span></div><div style="margin-top:5px;font-size:14px"><span>数量：</span><span class="num"></span></div></div></div><div class="modal-footer" style="margin-top: 0;"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="clickOrder(this)">确定</button></div></div></div></div></div></div>'
				$(popHtml).appendTo(document.getElementsByClassName('content_bottom')[0])
			})
		}, 'json')
	}
</script>
</html>

