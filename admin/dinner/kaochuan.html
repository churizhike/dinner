<!DOCTYPE HTML>
<html>
<head>
<title>Home</title>
<link href="../../css/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="../../css/bootstrap.css" rel='stylesheet' type='text/css' />
<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="../../js/jquery.min.js"></script>
<!-- Custom Theme files -->
<link href="../../css/style.css" rel='stylesheet' type='text/css' />
<!-- Custom Theme files -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
</script>
<!----webfonts---->
<link href='http://fonts.googleapis.com/css?family=Exo+2:100,200,300,400,500,600,700,800,900' rel='stylesheet' type='text/css'>
</head>
<body>
	<div class="header">
		<div class="container">
			<div class="header_top" style="width: 100%;">
				<ul class="phone" style="width: 100%;">
					<li class="phone_left"><i class="mobile"> </i><span>1-200-346-2986</span></li>
					<li class="phone_right" style="float: right;margin-right: 10%;"><span class="mobile">欢迎： </span><span>处日先生</span></li>
					<div class="clearfix"></div>
				</ul>
				<div class="clearfix"></div>
			</div>
		<div class="header_bottom">
		  <div class="header_nav">
      		<div class="logo">
				<a><img src="../../images/logo.png" alt=""/><br></a>
			 </div>
			 <nav class="navbar navbar-default menu" role="navigation"><h3 class="nav_right"><a href="index.html"><img src="../../images/logo.png" class="img-responsive" alt=""/></a></h3>
			  <div class="container-fluid">
			    <!-- Brand and toggle get grouped for better mobile display -->
			    <div class="navbar-header">
			      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
			        <span class="sr-only">Toggle navigation</span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
			    </div>
				<!-- Collect the nav links, forms, and other content for toggling -->
			    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav menu1">
						<li class="active"><a href="../admin.html">菜单</a></li>
					  <li><a href="../order.html">订单</a></li>
					</ul>
		          <ul class="login" style="cursor: pointer;">
		          	<a ><li class="login_top"><i class="sign"> </i><span>登出</span></li></a>
		            <!-- <a href="register.html"><li class="login_bottom"><i class="register"> </i><span>Register</span></li></a> -->
		          </ul>
			      <div class="clearfix"></div>
			    </div><!-- /.navbar-collapse -->
			  </div><!-- /.container-fluid -->
			</nav>
            <div class="clearfix"></div>
           </div>
            <!-- <div class="search">
			  <input type="text" class="text" value="Enter Product Details" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Enter Product Details';}">
			  <input type="submit" value="Search">
			</div> -->
		 </div>  
		</div>
	</div>
    <div class="main">
		<div class="container">
		   <div class="row content" style="margin-top: 30px;">
		   	<div class="col-md-3 content_top">
		   	   <div class="category_box">
		   	  	<h3 class="cate_head">点菜</h3>
		   	     <ul class="category">
					<li><a href="../admin.html">饺子类</a></li>
					<li><a href="./kaochuan.html">面类</a></li>
			   	  	<li><a href="./gaifan.html">盖饭类</a></li>
			   	  	<li><a href="./kaochuan.html" class="activeNav">烤串类</a></li>
			   	  	<li><a href="./xiaochao.html">家常小炒类</a></li>
			   	  	<li><a href="./yuxia.html">鱼虾类</a></li>
			   	  	<li><a href="./tang.html">汤类</a></li>
			   	  	<li><a href="./ganguo.html">干锅系列</a></li>
		   	     </ul>
		   	   </div>
		   	   <!-- <ul class="product_reviews">
		   	   	<h3><i class="arrow"> </i><span>产品评论</span></h3>
		   	   	<li>
		   	   		<ul class="review1">
		   	   			<li class="review1_img"><img src="../../images/pic1.jpg" class="img-responsive" alt=""/></li>
		   	   			<li class="review1_desc"><h3><a href="#">马家酸汤牛肉水饺</a></h3><p>Wed, June 2014</p></li>
		   	   			<div class="clearfix"> </div>
		   	   		</ul>
		   	   	</li>
		   	   	<li>
		   	   		<ul class="review1">
		   	   			<li class="review1_img"><img src="../../images/pic2.jpg" class="img-responsive" alt=""/></li>
		   	   			<li class="review1_desc"><h3><a href="#">香菇肉片盖饭</a></h3><p>Wed, June 2014</p></li>
		   	   			<div class="clearfix"> </div>
		   	   		</ul>
		   	   	</li>
		   	   	<li>
		   	   		<ul class="review1">
		   	   			<li class="review1_img"><img src="../../images/pic3.jpg" class="img-responsive" alt=""/></li>
		   	   			<li class="review1_desc"><h3><a href="#">烤香肠</a></h3><p>Wed, June 2014</p></li>
		   	   			<div class="clearfix"> </div>
		   	   		</ul>
		   	   	</li>
		   	    <div class="but">
			       <a href="#">More Reviews<i class="but_arrow"> </i></a>
			    </div>
		   	   </ul> -->
		   	</div>
		   	<div class="col-md-9">
				<div style="height: 30px;width: 100%;margin-bottom: 30px;">
					<button type="button" class="btn btn-primary btn-lg" style="float: right;" data-toggle="modal" data-target="#myModal">
						上传菜品
					</button>
				</div>
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
					<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title" id="myModalLabel">上传菜品<span style="font-size: 12px;">（当前分类：烤串类）</span></h4>
							<h4></h4>
						</div>
						<div class="modal-body">
							<div class="input-group">
								<span class="input-group-addon" id="basic-addon2">菜品名称</span>
								<input type="text" class="form-control" id="" placeholder="Recipient's username" aria-describedby="basic-addon2">
							</div>
							<div class="input-group" style="margin-top: 20px;">
								<span class="input-group-addon" id="basic-addon2">菜品价格</span>
								<input type="text" class="form-control" placeholder="Recipient's username" aria-describedby="basic-addon2">
							</div>
							<!-- <button type="button" class="btn btn-default" style="margin-top: 20px;">上传照片</button>
							<div class="form-group">
								<label for="exampleInputFile">File input</label>
								<input type="file" id="exampleInputFile">
								<p class="help-block">Example block-level help text here.</p>
							</div> -->
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="closeModal(this)">上传</button>
						</div>
					</div>
					</div>
				</div>
		   	   <div class="tlinks">Collect from <a href="http://www.cssmoban.com/"  title="网站模板">网站模板</a></div>
		   	   <div class="row content_bottom">
		    	</div>
		   </div>
		</div>
	</div>
</body>
<script>
	$(function () {
		$(".login").click(function() {
			console.log(8888)
			window.location.href = 'file:///C:/Users/Administrator/Desktop/dinner/index.html'
			sessionStorage.removeItem('userName')
			sessionStorage.removeItem('userPsword')
			alert('退出登录成功')
		})
		window.onload = handleList()
		$('.userName').innerHTML = sessionStorage.getItem('userName')
	})
	function clickEdit(obj) {
		obj.parentElement.getElementsByClassName('modal-body')[0].getElementsByTagName('input')[0].value = obj.parentElement.parentElement.getElementsByClassName('name')[0].innerHTML
		obj.parentElement.getElementsByClassName('modal-body')[0].getElementsByTagName('input')[1].value = obj.parentElement.parentElement.getElementsByClassName('actual')[0].innerHTML.split('.')[0]
	}
	function closeModal(obj) {
		
		var dinnerName = document.getElementsByClassName('modal-body')[0].getElementsByTagName('input')[0]
		var dinnerPrice = document.getElementsByClassName('modal-body')[0].getElementsByTagName('input')[1]
		if (dinnerName !== '' && dinnerPrice !== '') {
			const sendData = {
				mealName: dinnerName.value,
				mealPrice: dinnerPrice.value,
				mealType: 'kaochuan'
			}
			$.ajax({
				type : "POST",
				url : 'http://192.168.31.248:6736/menu/add', 
				data : JSON.stringify(sendData),
				// dataType: 'json',
				success : function(obj){
					handleList()
				},
				headers: {
					"Content-Type":"application/json"
				}
			})
		}
	}
	function deleteDinner(that) {
		const parentBox = that.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement
		const dinnerName = parentBox.getElementsByClassName('name')[0].innerHTML
		$.get('http://192.168.31.248:6736/menu/get', function(obj) {
			if (obj['kaochuan']) {
				obj['kaochuan'].map(item => {
					if (item.mealName === dinnerName) {
						$.ajax({
							type : "GET",
							url : 'http://192.168.31.248:6736/menu/delete', 
							// data : JSON.stringify(sendData),
							// dataType: 'json',
							success : function(obj){
								handleList()
							},
							headers: {
								"Content-Type":"application/json",
								"mealNumber": item.mealNumber
							}
						})
					}
				})
			}
		}, 'json')
	}
	function editDinner(obj) {
		const editName = obj.parentElement.parentElement.getElementsByClassName('modal-body')[0].getElementsByTagName('input')[0].value
		const editPrice = obj.parentElement.parentElement.getElementsByClassName('modal-body')[0].getElementsByTagName('input')[1].value
		const sourceName = obj.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName('name')[0].innerHTML
		$.get('http://192.168.31.248:6736/menu/get', function(obj) {
			if (obj['kaochuan']) {
				obj['kaochuan'].map(item => {
					if (item.mealName === sourceName) {
						const sendData = {
							mealName: editName,
							mealPrice: editPrice,
							mealNumber: item.mealNumber,
							mealType: 'kaochuan'
						}
						$.ajax({
							type : "POST",
							url : 'http://192.168.31.248:6736/menu/update', 
							data : JSON.stringify(sendData),
							// dataType: 'json',
							success : function(obj){
								handleList()
							},
							headers: {
								"Content-Type":"application/json",
								"mealNumber": item.mealNumber
							}
						})
					}
				})
			}
		}, 'json')
	}
	function handleList() {
		$.get('http://192.168.31.248:6736/menu/get', function(obj) {
			var imgArr = [
				'../images/p1.jpg',
				'../images/p2.jpg',
				'../images/p2.jpg',
				'../images/p2.jpg',
				'../images/p2.jpg',
				'../images/p2.jpg'
			]
			document.getElementsByClassName('content_bottom')[0].innerHTML = ''
			obj['kaochuan'].map((item, index) => {
				const imgNum = parseInt(Math.random()*20+1)
				console.log(imgNum)
				const parentBox1 = $("<div class='col-md-3 content_top_box'></div>")
				const parentBox2 = $("<div class='content_box'></div>")
				const parentBox3 = $("<div class='view view-fifth'></div>")
				const parentBox4 = $('<div class="content_box-grid"></div>')
				const img = $('<img src="../../images/p'+imgNum+'.jpg" class="img-responsive" style="width:187px;height:127px" alt=""/>')
				const name = $('<p class="name m_1">'+item.mealName+'</p>')
				const price = $('<div class="price">价格:￥<span class="actual">'+item.mealPrice+'</span></div>')
				const modal = $('<div class="but1" style="margin-top: 10px;"><div class="modal fade" id="myModal'+index+'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">本菜品<span style="font-size: 12px;">（当前分类：饺子）</span></h4><h4></h4></div><div class="modal-body"><div class="input-group"><span class="input-group-addon" id="basic-addon2">菜品名称</span><input type="text" class="form-control" id="" placeholder="Recipients username" aria-describedby="basic-addon2"></div><div class="input-group" style="margin-top: 20px;"><span class="input-group-addon" id="basic-addon2">菜品价格</span><input type="text" class="form-control" placeholder="Recipients username" aria-describedby="basic-addon2"></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="editDinner(this)">确定</button></div></div></div></div><a href="#" style="margin-left: 0px;color: #2ca1d2;" data-toggle="modal" data-target="#myModal'+index+'" onclick="clickEdit(this)">编辑</a><div class="modal fade" id="myModalIn'+index+'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog modal-sm" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">提示：</span></h4><h4></h4></div><div class="modal-body"><div class="input-group"><span class="" id="basic-addon2">确认删除？</span></div></div><div class="modal-footer" style="margin-top: 0;"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="deleteDinner(this)">确定</button></div></div></div></div><a href="#" style="margin-left: 20px;" class="deleteBtn" data-toggle="modal" data-target="#myModalIn'+index+'">删除</a></div>')
				img.appendTo(parentBox3)
				name.appendTo(parentBox4)
				price.appendTo(parentBox4)
				modal.appendTo(parentBox4)
				parentBox4.appendTo(parentBox3)
				parentBox3.appendTo(parentBox2)
				parentBox2.appendTo(parentBox1)
				parentBox1.appendTo(document.getElementsByClassName('content_bottom')[0])
			})
		}, 'json')
	}
</script>
</html>

